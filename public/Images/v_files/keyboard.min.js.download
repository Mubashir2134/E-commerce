!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).flowplayer=e.flowplayer||{},e.flowplayer.keyboard=t())}(this,(function(){"use strict";function e(e,t,n){const r=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(t);for(;r.length;){if(null==e)return n;const t=r.shift();if("string"!=typeof t)return n;e=e[t]}return null==e?n:e}var t={TAB:"Tab",ENTER:"Enter",ESCAPE:"Escape",SPACE:" ",ARROW_LEFT:"ArrowLeft",ARROW_UP:"ArrowUp",ARROW_RIGHT:"ArrowRight",ARROW_DOWN:"ArrowDown",F:"f",H:"h",J:"j",K:"k",L:"l",M:"m"};function n(){Array.from(document.querySelectorAll(".fp-engine")).forEach(e=>{var t;const n=e.root.querySelector("details[open].fp-menu-container");n&&(n.open=!1,null===(t=n.querySelector("summary"))||void 0===t||t.removeAttribute("aria-expanded"),e.root.classList.toggle("has-menu-opened",!1))})}document.addEventListener("click",(function(e){this.active_menu&&!e.composedPath().includes(this.active_menu)&&(n(),this.active_menu=void 0)}));let r=void 0;function o(e){e.setState("is-kb-active",!0),clearTimeout(r),r=setTimeout((function(){e.setState("is-kb-active",!1)}),2500)}function i(e,t){e.enqueueSeek(t)&&o(e)}const u="flowplayer-ad-ui";var a;let l=void 0;const s=[t.ARROW_UP,t.ARROW_RIGHT,t.ARROW_LEFT,t.ARROW_DOWN],c=[t.SPACE,t.F,t.ESCAPE,t.M,t.ARROW_UP,t.ARROW_DOWN,t.ARROW_RIGHT,t.ARROW_LEFT,t.H,t.J,t.K,t.L];function f(e,t){e.volume=function(e,t,n=0){return Math.max(Math.min(t,e),n)}(e.volume+t,1,0),o(e)}function d(e){e.preventDefault(),e.stopPropagation()}function R(r){var o,a;const l=r.key,R=A(),p=document.activeElement;if(!p)return;if(l===t.TAB){if(!R)return;if(R.setState("is-hovered",!0),R.setState("is-accessibility",!0),!function(e){var t,n;return!(!e.hasState("ad-paused")&&!e.hasState("ad-playing")||!(null===(n=null===(t=null==e?void 0:e.ads)||void 0===t?void 0:t.adapter)||void 0===n?void 0:n.isLinearAd()))}(R)||m(p,u))return;const e=R.root.querySelector(u);if(!e)return;if(R.hasState("ad-playing"))return null===(o=e.querySelector(".fp-small-pause"))||void 0===o?void 0:o.focus();if(R.hasState("ad-paused"))return null===(a=e.querySelector(".fp-small-play"))||void 0===a?void 0:a.focus()}if((l===t.SPACE||l===t.ENTER)&&p.hasAttribute("tabindex")&&(m(p,".flowplayer")||m(p,"flowplayer-playlist-controls")))return null==p||p.dispatchEvent(new CustomEvent("click",{cancelable:!0,bubbles:!0})),d(r);if((l===t.ARROW_DOWN||l===t.ARROW_UP||l===t.ESCAPE)&&(m(p,".fp-menu-container")||m(p,"flowplayer-playlist-controls"))){if(l===t.ARROW_DOWN&&p.nextSibling)return p.nextSibling.focus();if(l===t.ARROW_UP&&p.previousSibling)return p.previousSibling.focus();if(l===t.ESCAPE){const e=new CustomEvent("keyboard:close:menus",{cancelable:!0});if(null==R||R.dispatchEvent(e),e.defaultPrevented)return;return n()}}if(!R)return;let y=e(R,"opts.keyboard.seek_step",5);if(y<1&&(y=Math.round(y*R.duration)),~s.indexOf(l)&&p.hasAttribute("aria-valuenow")){const e=~[t.ARROW_UP,t.ARROW_RIGHT].indexOf(l);if(p.matches(".fp-volume"))return f(R,e?.15:-.15),d(r);if(p.matches(".fp-timeline"))return i(R,e?y:-1*y),d(r)}if(!1===function(e,t){return!(t.altKey||t.shiftKey||t.metaKey||t.ctrlKey)&&(!!(e&&e.hasState("is-in-viewport")&&e.started)&&(!!e.root&&void 0))}(R,r))return;const v=!R.hasState("no-timeline");switch(~c.indexOf(l)&&r.preventDefault(),l){case t.SPACE:return R.togglePlay();case t.F:return R.toggleFullScreen();case t.ESCAPE:return R.hasState("is-fullscreen")?R.toggleFullScreen(!1):(null==p||p.blur(),R.setState("is-hovered",!1),R.setState("is-accessibility",!1));case t.M:return R.toggleMute();case t.ARROW_UP:case t.K:return f(R,.15);case t.ARROW_DOWN:case t.J:return f(R,-.15);case t.ARROW_RIGHT:case t.L:return v&&i(R,y);case t.ARROW_LEFT:case t.H:return v&&i(R,-1*y)}}function p(e){setTimeout((function(){e.defaultPrevented||R(e)}),0)}function A(){return y().find(e=>function(e){let t=document.activeElement;for(;t;){if(t===e)return!0;t=t.parentElement}return!1}(e.root))||y().find(e=>document.activeElement===document.body&&e.root.hasFocus)}function y(){return Array.from(document.querySelectorAll(".fp-engine"))}function m(e,t){return!!function(e,t){return e.closest(t)}(e,t)}document.addEventListener("keydown",(function(e){if(e.key===t.TAB)return p(e);if(l=A(),l)return function(e,n){const r=document.activeElement;if(e.key===t.F&&n.root.classList.contains("no-fullscreen"))return;if([t.SPACE,t.ARROW_DOWN,t.ARROW_UP,t.ARROW_RIGHT,t.ARROW_LEFT].includes(e.key)||r&&m(r,".fp-menu-container")&&e.key===t.ENTER)return e.preventDefault(),R(e);p(e)}(e,l);const n=document.activeElement;[t.SPACE,t.ENTER,t.ARROW_DOWN,t.ARROW_UP,t.ARROW_RIGHT,t.ARROW_LEFT].includes(e.key)&&n&&m(n,"flowplayer-playlist-controls")&&(e.preventDefault(),R(e))})),document.addEventListener("click",(function(e){const t=e.composedPath();y().forEach(e=>{e.root.hasFocus=t.includes(e.root)})}));const v=((a=class Keyboard{init(e,t,n){}}).pluginName="keyboard",a);return function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;if(null===document.currentScript)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});const n=e.flowplayer;return"function"==typeof n?(n(t),t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t),t)}(window,v)}));
